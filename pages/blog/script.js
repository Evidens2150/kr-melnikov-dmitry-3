"use strict";function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||i(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=i(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){c=!0,a=t},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw a}}}}function i(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var v=document.querySelector(".blog-previous-page-button_js"),y=document.querySelector(".blog-next-page-button_js"),c=document.querySelector(".tags_js"),w=document.querySelector(".posts_js"),S=document.querySelector(".blog-pagination_js"),u=(document.querySelectorAll(".link_js"),document.forms.filter),x={page:0};function L(t){t.preventDefault(),w.innerHTML=preloaderCreator();var e=x.page||0;(x=getFormData(u)).page=e,x.show=+x.show||0,function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=Object.keys(t),n=new URL("http://evidens.com"),o=0,r=e;o<r.length;o++){var a=r[o];if("object"===l(t[a])){var s,c=b(t[a]);try{for(c.s();!(s=c.n()).done;){var i=s.value;n.searchParams.append(a,i)}}catch(t){c.e(t)}finally{c.f()}}else n.searchParams.append(a,t[a])}history.replaceState({},document.title,n.search)}(x),n(x)}function n(f){var t=new URL("http://evidens.com");f.page||(f.page=0),f.tags&&t.searchParams.set("tags",JSON.stringify(f.tags)),t.searchParams.set("v",VERSION_API);var e,n,o,r={};f.title&&(r.title=f.title),f.views&&(e=f.views.split("-"),r.views={$between:[e[0],e[1]]}),0!==f.commentsCount.length&&(n=[],f.commentsCount.forEach(function(t){t.split("-").forEach(function(t){n.push(t)})}),o={min:Math.min.apply(null,n),max:Math.max.apply(null,n)},r.commentsCount={$between:[o.min,o.max]}),t.searchParams.set("filter",JSON.stringify(r));var a=["id","ASC"];f.sort&&(a[0]=f.sort),t.searchParams.set("sort",JSON.stringify(a)),f.show&&t.searchParams.set("limit",JSON.stringify(+f.show)),t.searchParams.set("offset",JSON.stringify(f.show*f.page));var h=new XMLHttpRequest;h.open("GET","".concat(SERVER_URL,"/api/posts?").concat(t.searchParams)),h.send(),h.onload=function(){var t,e=JSON.parse(h.response);if(e.success){w.innerHTML="";var n,o=b(e.data);try{for(o.s();!(n=o.n()).done;){var r=n.value;w.innerHTML+=(t=r,'\n\t<li class="blog__item">\n\t\t<div class="blog__item-content">\n\t\t\t<picture>\n\t\t\t\t<source srcset="'.concat(SERVER_URL).concat(t.photo.desktopPhotoUrl,'", srcset="').concat(SERVER_URL).concat(t.photo.desktop2xPhotoUrl,'" 2x" media="(min-width: 800px)">\n\t\t\t\t<source srcset="').concat(SERVER_URL).concat(t.photo.tabletPhotoUrl,', srcset="').concat(SERVER_URL).concat(t.photo.tablet2xPhotoUrl,' 2x" media="(min-width: 670px) and (max-width: 799px)">\n\t\t\t\t<source srcset="').concat(SERVER_URL).concat(t.photo.mobilePhotoUrl,', srcset="').concat(SERVER_URL).concat(t.photo.mobile2xPhotoUrl,' 2x" media="(max-width: 669px)">\n\t\t\t\t<img class="blog__img" src="').concat(SERVER_URL).concat(t.photo.desktopPhotoUrl,'" alt="').concat(t.title,'">\n\t\t\t</picture>\n\t\t\t<div class="blog__description">\n\t\t\t\t<div class="blog__tags cardTags_js"></div>\n\t\t\t\t<div class="blog__info">\n\t\t\t\t\t<span class="blog__data text_small text_gray">').concat(new Date(t.date).toLocaleDateString(),'</span>\n\t\t\t\t\t<span class="blog__views text_small text_gray">').concat(t.views,' views</span>\n\t\t\t\t\t<span class="blog__comments text_small text_gray">').concat(t.commentsCount,' comments</span>\n\t\t\t\t</div>\n\t\t\t\t<h3 class="blog__title h3">').concat(t.title,'</h3>\n\t\t\t\t<p class="blog__text text">').concat(t.text,'</p>\n\t\t\t\t<a class="blog__link text text_bold" href="#">Go to this post</a>\n\t\t\t</div>\n\t\t</div>\n\t</li>'));var a,s=_(document.querySelectorAll(".blog__item")),c=s[s.length-1].querySelector(".cardTags_js"),i=b(r.tags);try{for(i.s();!(a=i.n()).done;){var l=a.value;c.innerHTML+='<span class="blog__tag" style="background-color: '.concat(l.color,'"></span>')}}catch(t){i.e(t)}finally{i.f()}}}catch(t){o.e(t)}finally{o.f()}var u=e.count,p=0;for(S.innerHTML="";0<u-f.show;){u-=f.show;var d=E(p,x,function(t){L(t)});p++,S.insertAdjacentElement("beforeend",d)}var m=E(p,x,function(t){L(t)});S.insertAdjacentElement("beforeend",m);var g=_(S.querySelectorAll(".page-link_js"));0===x.page?v.setAttribute("disabled",""):v.removeAttribute("disabled"),x.page===g.length-1||1===g.length?y.setAttribute("disabled",""):y.removeAttribute("disabled"),S.querySelector(".page_".concat(x.page)).classList.add("blog__pagination__link_active"),""===w.innerHTML&&(w.innerHTML='\n  <li class="blog__item"><p class="blog__message h1">No matching search results</p></li>\n  ',S.innerHTML="",y.setAttribute("disabled",""))}else console.error(e._message)},h.onerror=function(){return console.error("Произошла ошибка сервера")}}function E(e,n,o){var t=document.createElement("li");t.classList.add("blog__pagination-item");var r=document.createElement("a");return r.setAttribute("href","?page=".concat(+e+1)),r.classList.add("blog__pagination__link","text","text_bold","page-link_js","page_".concat(+e)),r.addEventListener("click",function(t){t.preventDefault(),n.page=e,o(t)}),r.innerText=+e+1,t.insertAdjacentElement("beforeend",r),t}!function(){c.innerHTML=preloaderCreator(),w.innerHTML=preloaderCreator(),n(getFormData(u));var s=new XMLHttpRequest;s.open("GET","".concat(SERVER_URL,"/api/tags")),s.send(),s.onload=function(){var t,e=JSON.parse(s.response);if(e.success){c.innerHTML="";var n,o=b(e.data);try{for(o.s();!(n=o.n()).done;){var r=n.value;c.innerHTML+='\n\t<label class="filter__form__checkbox-label_tags">\n\t\t<input class="filter__form__checkbox hidden" type="checkbox" name="tags" id="checkTag'.concat((t=r).id,'" value="').concat(t.id,'" checked>\n\t\t<span style="border-color: ').concat(t.color,'" class="filter__form__checkbox-checker"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t<path d="M2 6.75L5.91301 12.77C6.20128 13.2135 6.85836 13.1893 7.11327 12.7259L13.425 1.25" stroke="').concat(t.color,'" stroke-width="2.5" stroke-linecap="round"/>\n\t\t</svg></span>\n\t</label>')}}catch(t){o.e(t)}finally{o.f()}var a=function(){var t=new URL(window.location).searchParams,e={};t.has("tags")&&(e.tags=t.getAll("tags"));t.has("views")&&(e.views=t.get("views"));t.has("commentsCount")&&(e.commentsCount=t.getAll("commentsCount"));t.has("show")&&(e.show=t.get("show"));t.has("sort")&&(e.sort=t.get("sort"));t.has("search")&&(e.search=t.get("search"));t.has("page")&&(e.page=t.get("page"));return e}();setValueToForm(u,a)}else console.log(e._message)},s.onerror=function(){console.error("Произошла ошибка сервера")},u.addEventListener("submit",function(t){x.page=0,L(t)}),v.addEventListener("click",function(t){x.page--,L(t)}),y.addEventListener("click",function(t){x.page++,L(t)})}();